{% load static %}

<nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
    <div class="container">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand d-flex align-items-center" href="{% url 'home' %}">
            <img src="{% static 'images/logo.png' %}" alt="SICMI SARL" style="height: 40px; width: auto;">
            <div class="ms-2 d-none d-md-block">
                <div class="fw-bold text-white">SICMI Sarl</div>
                <small class="text-white-50">Ingénierie & Maintenance Industrielle</small>
            </div>
        </a>
        
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center">
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/' %}active{% endif %}" href="{% url 'home' %}">
                        Accueil
                    </a>
                </li>
                
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle {% if 'services' in request.path %}active{% endif %}" 
                       href="#" id="servicesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Services
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="servicesDropdown">
                        <li>
                            <a class="dropdown-item" href="{% url 'services' %}">
                                <i class="fas fa-list me-2"></i>Tous nos services
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item" href="{% url 'services' %}#construction">
                                <i class="fas fa-industry me-2"></i>Constructions neuves
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'services' %}#maintenance">
                                <i class="fas fa-tools me-2"></i>Maintenance industrielle
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'services' %}#accompagnement">
                                <i class="fas fa-hands-helping me-2"></i>Accompagnement
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'services' %}#facade">
                                <i class="fas fa-building me-2"></i>Travaux de façade
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'services' %}#renovation">
                                <i class="fas fa-paint-roller me-2"></i>Rénovation
                            </a>
                        </li>
                    </ul>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/projets/' %}active{% endif %}" href="{% url 'projects' %}">
                        Réalisations
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/contact/' %}active{% endif %}" href="{% url 'contact' %}">
                        Contact
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/a-propos/' %}active{% endif %}" href="{% url 'about' %}">
                        À Propos
                    </a>
                </li>

                <!-- Menu déroulant QHSE & RSE -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle {% if 'qhse_policy' in request.path %}active{% endif %}" 
                       href="#" id="qhseDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        QHSE & RSE
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="qhseDropdown">
                        <li>
                            <a class="dropdown-item" href="{% url 'qhse_policy' %}">
                                <i class="fas fa-file-contract me-2"></i>Politique QHSE & RSE
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item" href="{% url 'qhse_policy' %}#qhse">
                                <i class="fas fa-shield-alt me-2"></i>Politique QHSE
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'qhse_policy' %}#rse">
                                <i class="fas fa-leaf me-2"></i>Engagement RSE
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'qhse_policy' %}#certifications">
                                <i class="fas fa-certificate me-2"></i>Nos Certifications
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'qhse_policy' %}#engagement">
                                <i class="fas fa-handshake me-2"></i>Engagement Direction
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/equipe/' %}active{% endif %}" href="{% url 'team' %}">
                        Notre Équipe
                    </a>
                </li>
            </ul>
        
        </div>
        
        <!-- Barra di ricerca espandibile -->
        <div class="search-overlay" id="searchOverlay">
            <div class="search-container">
                <button class="search-close" id="searchClose" type="button" aria-label="Fermer">
                    <i class="fas fa-times"></i>
                </button>
                <form action="{% url 'search' %}" method="get" class="search-form">
                    <input type="search" name="q" class="search-input-large" 
                           placeholder="Rechercher des services, projets..." 
                           aria-label="Rechercher" autofocus>
                    <button type="submit" class="search-submit">
                        <i class="fas fa-search"></i>
                        <span class="ms-2">Rechercher</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</nav>

<script>
// Animation améliorée pour la navigation
document.addEventListener('DOMContentLoaded', function() {
    // Toggle ricerca overlay
    const searchToggle = document.getElementById('searchToggle');
    const searchClose = document.getElementById('searchClose');
    const searchOverlay = document.getElementById('searchOverlay');
    
    if (searchToggle && searchOverlay) {
        searchToggle.addEventListener('click', function() {
            searchOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            setTimeout(() => {
                const input = searchOverlay.querySelector('.search-input-large');
                if (input) input.focus();
            }, 300);
        });
    }
    
    if (searchClose && searchOverlay) {
        searchClose.addEventListener('click', function() {
            searchOverlay.classList.remove('active');
            document.body.style.overflow = '';
        });
        
        // Chiudi con ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && searchOverlay.classList.contains('active')) {
                searchOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
        
        // Chiudi cliccando fuori
        searchOverlay.addEventListener('click', function(e) {
            if (e.target === searchOverlay) {
                searchOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    }

    // Animation des dropdowns
    const dropdowns = document.querySelectorAll('.dropdown');
    
    dropdowns.forEach(dropdown => {
        dropdown.addEventListener('show.bs.dropdown', function() {
            const menu = this.querySelector('.dropdown-menu');
            menu.style.opacity = '0';
            menu.style.transform = 'translateY(-10px) scale(0.95)';
        });
        
        dropdown.addEventListener('shown.bs.dropdown', function() {
            const menu = this.querySelector('.dropdown-menu');
            menu.style.opacity = '1';
            menu.style.transform = 'translateY(0) scale(1)';
            menu.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        });
    });

    // Navigation active avec highlight
    function updateActiveNav() {
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.nav-link');
        
        navLinks.forEach(link => {
            link.classList.remove('active');
            
            // Gestion des liens exacts
            if (link.getAttribute('href') === currentPath) {
                link.classList.add('active');
            }
            
            // Gestion des liens parents pour les dropdowns
            if (currentPath.includes('/services/') && link.getAttribute('href') === '/services/') {
                link.classList.add('active');
            }
            
            if (currentPath.includes('/politique-qhse/') && 
                link.classList.contains('dropdown-toggle') && link.getAttribute('href') === '#') {
                link.classList.add('active');
            }
        });
    }

    updateActiveNav();

    // Ajout d'un effet de pulse sur le logo au chargement
    const logo = document.querySelector('.navbar-brand img');
    if (logo) {
        setTimeout(() => {
            logo.style.transform = 'scale(1.1)';
            logo.style.transition = 'transform 0.3s ease';
            setTimeout(() => {
                logo.style.transform = 'scale(1)';
            }, 300);
        }, 1000);
    }

    // Gestion du scroll pour la navbar
    let lastScrollTop = 0;
    const navbar = document.querySelector('.navbar');
    
    window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        if (scrollTop > lastScrollTop && scrollTop > 100) {
            // Scroll vers le bas
            navbar.style.transform = 'translateY(-100%)';
        } else {
            // Scroll vers le haut
            navbar.style.transform = 'translateY(0)';
        }
        
        navbar.style.transition = 'transform 0.3s ease';
        lastScrollTop = scrollTop;
    });

    // Animation des liens au survol
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        link.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.transition = 'transform 0.2s ease';
        });
        
        link.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });

    // Gestion responsive améliorée
    function handleResponsiveNav() {
        const navbarCollapse = document.getElementById('navbarNav');
        const isMobile = window.innerWidth < 992;
        
        if (isMobile) {
            // Ajouter une classe pour le style mobile
            navbarCollapse.classList.add('mobile-nav');
        } else {
            navbarCollapse.classList.remove('mobile-nav');
        }
    }

    // Écouter les changements de taille d'écran
    window.addEventListener('resize', handleResponsiveNav);
    handleResponsiveNav();

    // Fermer le menu mobile après clic sur un lien
    const navLinksMobile = document.querySelectorAll('.navbar-nav .nav-link:not(.dropdown-toggle)');
    const navbarToggler = document.querySelector('.navbar-toggler');
    const navbarCollapse = document.getElementById('navbarNav');
    
    navLinksMobile.forEach(link => {
        link.addEventListener('click', () => {
            if (window.innerWidth < 992) {
                const bsCollapse = new bootstrap.Collapse(navbarCollapse, {
                    toggle: false
                });
                bsCollapse.hide();
            }
        });
    });
    
    // Chiudere il menu mobile dopo aver selezionato un elemento dropdown
    const dropdownItems = document.querySelectorAll('.dropdown-item');
    dropdownItems.forEach(item => {
        item.addEventListener('click', () => {
            if (window.innerWidth < 992) {
                setTimeout(() => {
                    const bsCollapse = new bootstrap.Collapse(navbarCollapse, {
                        toggle: false
                    });
                    bsCollapse.hide();
                }, 300);
            }
        });
    });
});

// Fonction pour le menu mobile personnalisé
function toggleMobileMenu() {
    const navbar = document.getElementById('navbarNav');
    const isExpanded = navbar.classList.contains('show');
    
    if (isExpanded) {
        navbar.style.maxHeight = '0px';
        navbar.style.opacity = '0';
        setTimeout(() => {
            navbar.classList.remove('show');
        }, 300);
    } else {
        navbar.classList.add('show');
        setTimeout(() => {
            navbar.style.maxHeight = '500px';
            navbar.style.opacity = '1';
        }, 10);
    }
}

// Style CSS additionnel pour la navigation
const additionalStyles = `
/* Animation pour la navbar sticky */
.navbar.sticky-top {
    transition: transform 0.3s ease;
}

/* Style pour le menu mobile */
@media (max-width: 991.98px) {
    .navbar-collapse.mobile-nav {
        background: linear-gradient(135deg, #0056b3 0%, #004494 100%);
        margin-top: 10px;
        border-radius: 10px;
        padding: 15px;
    }
    
    .navbar-collapse.mobile-nav .nav-link {
        padding: 10px 15px;
        margin: 2px 0;
        border-radius: 5px;
        transition: all 0.3s ease;
    }
    
    .navbar-collapse.mobile-nav .nav-link:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
    }
    
    .navbar-collapse.mobile-nav .dropdown-menu {
        background: rgba(255, 255, 255, 0.95);
        border: none;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .navbar-collapse.mobile-nav .dropdown-item {
        padding: 8px 15px;
    }
}

/* Amélioration des dropdowns */
.dropdown-menu {
    border: none;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    border-radius: 10px;
    padding: 10px 0;
    margin-top: 10px;
}

.dropdown-item {
    padding: 8px 20px;
    border-radius: 5px;
    margin: 2px 10px;
    transition: all 0.3s ease;
}

.dropdown-item:hover {
    background: linear-gradient(135deg, #0056b3 0%, #004494 100%);
    color: white;
    transform: translateX(5px);
}

/* Style pour la navigation secondaire mobile */
.bg-primary .row a {
    transition: all 0.3s ease;
}

.bg-primary .row a:hover {
    background: rgba(255, 255, 255, 0.1);
    text-decoration: none;
}

/* Animation du breadcrumb */
.breadcrumb-item a {
    transition: color 0.3s ease;
}

.breadcrumb-item a:hover {
    color: var(--primary-color) !important;
}

/* Logo animation */
.navbar-brand img {
    transition: transform 0.3s ease;
}

.navbar-brand:hover img {
    transform: scale(1.05);
}

/* Search overlay styles */
.search-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.95);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.search-overlay.active {
    opacity: 1;
    visibility: visible;
}

.search-container {
    position: relative;
    width: 90%;
    max-width: 800px;
    transform: translateY(-50px);
    transition: transform 0.3s ease;
}

.search-overlay.active .search-container {
    transform: translateY(0);
}

.search-close {
    position: absolute;
    top: -50px;
    right: 0;
    background: none;
    border: none;
    color: white;
    font-size: 2rem;
    cursor: pointer;
    transition: transform 0.3s ease;
    padding: 0;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.search-close:hover {
    transform: rotate(90deg);
}

.search-form {
    display: flex;
    gap: 1rem;
}

.search-input-large {
    flex: 1;
    padding: 1.5rem 2rem;
    font-size: 1.5rem;
    border: none;
    border-radius: 50px;
    background: white;
    color: #333;
}

.search-input-large:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.3);
}

.search-submit {
    padding: 1.5rem 3rem;
    background: linear-gradient(135deg, #0056b3 0%, #004494 100%);
    color: white;
    border: none;
    border-radius: 50px;
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.search-submit:hover {
    transform: translateX(5px);
    box-shadow: 0 5px 20px rgba(0, 86, 179, 0.4);
}

@media (max-width: 768px) {
    .search-form {
        flex-direction: column;
    }
    
    .search-input-large {
        font-size: 1.2rem;
        padding: 1rem 1.5rem;
    }
    
    .search-submit {
        padding: 1rem 2rem;
        font-size: 1rem;
    }
}
`;

// Injecter les styles additionnels
const styleSheet = document.createElement('style');
styleSheet.textContent = additionalStyles;
document.head.appendChild(styleSheet);
</script>